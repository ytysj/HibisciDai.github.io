<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Struts2学习笔记"><meta name="keywords" content="框架,Struts2"><meta name="author" content="HibisciDai,undefined"><meta name="copyright" content="HibisciDai"><title>Struts2学习笔记 | HibisciDai</title><link rel="shortcut icon" href="/img/Avatar.png"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.1"><link rel="stylesheet" type="text/css" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script><script src="https://unpkg.com/blueimp-md5@latest/js/md5.min.js"></script><script>var GLOBAL = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: {"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}"},"path":"search.xml"}
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Struts2框架引言"><span class="toc-number">1.</span> <span class="toc-text">Struts2框架引言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是框架-FrameWork"><span class="toc-number">1.1.</span> <span class="toc-text">什么是框架(FrameWork)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Struts2框架的概念"><span class="toc-number">1.2.</span> <span class="toc-text">Struts2框架的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MVC设计思想的优点"><span class="toc-number">1.2.1.</span> <span class="toc-text">MVC设计思想的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#现有的MVC控制层所存在的问题"><span class="toc-number">1.2.2.</span> <span class="toc-text">现有的MVC控制层所存在的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Struts2的实战开发思路"><span class="toc-number">1.2.3.</span> <span class="toc-text">Struts2的实战开发思路</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第一个Struts2程序的开发"><span class="toc-number">2.</span> <span class="toc-text">第一个Struts2程序的开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#搭建开发环境"><span class="toc-number">2.1.</span> <span class="toc-text">搭建开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#引入核心jar包"><span class="toc-number">2.1.1.</span> <span class="toc-text">引入核心jar包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#引入第三方jar包"><span class="toc-number">2.1.2.</span> <span class="toc-text">引入第三方jar包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#引入Struts-xml配置文件"><span class="toc-number">2.1.3.</span> <span class="toc-text">引入Struts.xml配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置Struts2核心过滤器"><span class="toc-number">2.1.4.</span> <span class="toc-text">配置Struts2核心过滤器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发步骤"><span class="toc-number">2.2.</span> <span class="toc-text">开发步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实现Action接口"><span class="toc-number">2.2.1.</span> <span class="toc-text">实现Action接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置文件配置"><span class="toc-number">2.2.2.</span> <span class="toc-text">配置文件配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ServletActionContext类的使用"><span class="toc-number">2.2.3.</span> <span class="toc-text">ServletActionContext类的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Strtus2的另一种访问方式"><span class="toc-number">2.2.4.</span> <span class="toc-text">Strtus2的另一种访问方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Struts2的跳转-4种-重点"><span class="toc-number">3.</span> <span class="toc-text">Struts2的跳转(4种|重点)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Action跳转JSP"><span class="toc-number">3.1.</span> <span class="toc-text">Action跳转JSP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#默认Forward跳转"><span class="toc-number">3.1.1.</span> <span class="toc-text">默认Forward跳转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redirect跳转"><span class="toc-number">3.1.2.</span> <span class="toc-text">Redirect跳转</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Action跳Action"><span class="toc-number">3.2.</span> <span class="toc-text">Action跳Action</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Forward跳转"><span class="toc-number">3.2.1.</span> <span class="toc-text">Forward跳转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redirect跳转-1"><span class="toc-number">3.2.2.</span> <span class="toc-text">Redirect跳转</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#包-lt-PACKAGE-gt"><span class="toc-number">3.3.</span> <span class="toc-text">包 &lt; PACKAGE &gt;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命名空间-lt-NAMESPACE-gt"><span class="toc-number">3.4.</span> <span class="toc-text">命名空间 &lt; NAMESPACE &gt;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨包间的跳转"><span class="toc-number">3.5.</span> <span class="toc-text">跨包间的跳转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#全局跳转"><span class="toc-number">3.6.</span> <span class="toc-text">全局跳转</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#注意事项"><span class="toc-number">3.6.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#STRUTS2接收CLIENT的参数-重点"><span class="toc-number">4.</span> <span class="toc-text">STRUTS2接收CLIENT的参数(重点)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#收集客户端的零散数据"><span class="toc-number">4.1.</span> <span class="toc-text">收集客户端的零散数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过对象收集客户端的数据"><span class="toc-number">4.2.</span> <span class="toc-text">通过对象收集客户端的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过数组或集合的形式收集客户端的数据"><span class="toc-number">4.3.</span> <span class="toc-text">通过数组或集合的形式收集客户端的数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#STRUTS2中ACTION的第二种开发方式"><span class="toc-number">5.</span> <span class="toc-text">STRUTS2中ACTION的第二种开发方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DMI（DYNAMIC-METHOD-INVOKE-动态方法调用）-实战"><span class="toc-number">6.</span> <span class="toc-text">DMI（DYNAMIC    METHOD   INVOKE  动态方法调用）(实战)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#编码"><span class="toc-number">6.1.</span> <span class="toc-text">编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置"><span class="toc-number">6.2.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一种配置"><span class="toc-number">6.2.1.</span> <span class="toc-text">第一种配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二种配置"><span class="toc-number">6.2.2.</span> <span class="toc-text">第二种配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#STRUTS2中的数据处理机制"><span class="toc-number">7.</span> <span class="toc-text">STRUTS2中的数据处理机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#OGNL表达式"><span class="toc-number">7.1.</span> <span class="toc-text">OGNL表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#从Root区取数据"><span class="toc-number">7.1.1.</span> <span class="toc-text">从Root区取数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#从Root去中取所存对象的属性值语法：直接属性名的方式"><span class="toc-number">7.1.1.1.</span> <span class="toc-text">从Root去中取所存对象的属性值语法：直接属性名的方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#从root区中取某一个对象中的关联对象的属性值-关联引用名-属性"><span class="toc-number">7.1.1.2.</span> <span class="toc-text">从root区中取某一个对象中的关联对象的属性值:关联引用名.属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#从root区中取某一个对象当中的List集合中的元素-List集合引用名-下标"><span class="toc-number">7.1.1.3.</span> <span class="toc-text">从root区中取某一个对象当中的List集合中的元素:List集合引用名[下标]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#从root区中取某一个对象当中的Map集合中的某一个元素-map集合的引用名-键"><span class="toc-number">7.1.1.4.</span> <span class="toc-text">从root区中取某一个对象当中的Map集合中的某一个元素:map集合的引用名[键]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ognl表达式中的运算"><span class="toc-number">7.1.1.5.</span> <span class="toc-text">ognl表达式中的运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OGNL表达式可以调用某种数据类型的方法"><span class="toc-number">7.1.1.6.</span> <span class="toc-text">OGNL表达式可以调用某种数据类型的方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#从ContextMap区取数据"><span class="toc-number">7.1.2.</span> <span class="toc-text">从ContextMap区取数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VALUESTACK"><span class="toc-number">7.2.</span> <span class="toc-text">VALUESTACK</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#作用：管理-存储-一次请求有效的数据"><span class="toc-number">7.2.1.</span> <span class="toc-text">作用：管理(存储)一次请求有效的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#好处"><span class="toc-number">7.2.2.</span> <span class="toc-text">好处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取值栈"><span class="toc-number">7.2.3.</span> <span class="toc-text">获取值栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#值栈的生命周期-request作用域"><span class="toc-number">7.2.4.</span> <span class="toc-text">值栈的生命周期(request作用域)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#值栈的内存结构"><span class="toc-number">7.2.5.</span> <span class="toc-text">值栈的内存结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#值栈的注意事项"><span class="toc-number">7.2.6.</span> <span class="toc-text">值栈的注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STRUTS中的标签-上"><span class="toc-number">7.3.</span> <span class="toc-text">STRUTS中的标签(上)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#显示数据"><span class="toc-number">7.3.1.</span> <span class="toc-text">显示数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#显示单个数据"><span class="toc-number">7.3.1.1.</span> <span class="toc-text">显示单个数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#显示多个数据"><span class="toc-number">7.3.1.2.</span> <span class="toc-text">显示多个数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#从数组或集合中显示数据-对象类型"><span class="toc-number">7.3.1.2.1.</span> <span class="toc-text">从数组或集合中显示数据(对象类型)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#从数组或集合中显示数据-String类型和8种基本类型"><span class="toc-number">7.3.1.2.2.</span> <span class="toc-text">从数组或集合中显示数据(String类型和8种基本类型)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#遍历状态"><span class="toc-number">7.3.1.2.3.</span> <span class="toc-text">遍历状态</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STRUTS2数据处理机制的补充"><span class="toc-number">7.4.</span> <span class="toc-text">STRUTS2数据处理机制的补充</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Action中的成员变量替换request作用域"><span class="toc-number">7.4.1.</span> <span class="toc-text">Action中的成员变量替换request作用域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简化值栈操作session作用域，application作用域的开发"><span class="toc-number">7.4.2.</span> <span class="toc-text">简化值栈操作session作用域，application作用域的开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么叫值栈？值栈体现在哪个区呢"><span class="toc-number">7.4.3.</span> <span class="toc-text">为什么叫值栈？值栈体现在哪个区呢?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DEBUG使用"><span class="toc-number">7.4.4.</span> <span class="toc-text">DEBUG使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结：现有STRUTS2的开发步骤"><span class="toc-number">7.4.5.</span> <span class="toc-text">总结：现有STRUTS2的开发步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STRUTS标签-续"><span class="toc-number">7.5.</span> <span class="toc-text">STRUTS标签(续)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lt-s-date-gt"><span class="toc-number">7.5.1.</span> <span class="toc-text">&lt;s:date/&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lt-s-url-gt"><span class="toc-number">7.5.2.</span> <span class="toc-text">&lt;s:url/&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#s标签中与html相关的UI标签"><span class="toc-number">7.5.3.</span> <span class="toc-text">s标签中与html相关的UI标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lt-s-action-gt"><span class="toc-number">7.5.4.</span> <span class="toc-text">&lt;s:action /&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#针对于前台视图"><span class="toc-number">7.5.5.</span> <span class="toc-text">针对于前台视图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#STRUTS2中的拦截器"><span class="toc-number">8.</span> <span class="toc-text">STRUTS2中的拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#拦截器的作用：把多个ACTION中的冗余代码，抽取到拦截器中，解决代码冗余问题"><span class="toc-number">8.1.</span> <span class="toc-text">拦截器的作用：把多个ACTION中的冗余代码，抽取到拦截器中，解决代码冗余问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用"><span class="toc-number">8.2.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#编码implements-Interceptor接口"><span class="toc-number">8.2.1.</span> <span class="toc-text">编码implements  Interceptor接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置-1"><span class="toc-number">8.2.2.</span> <span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意："><span class="toc-number">8.3.</span> <span class="toc-text">注意：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#拦截响应"><span class="toc-number">8.3.1.</span> <span class="toc-text">拦截响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#中断请求"><span class="toc-number">8.3.2.</span> <span class="toc-text">中断请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拦截器只在本包中有效"><span class="toc-number">8.3.3.</span> <span class="toc-text">拦截器只在本包中有效</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简化拦截器开发-继承AbstractInterceptor类"><span class="toc-number">8.3.4.</span> <span class="toc-text">简化拦截器开发  继承AbstractInterceptor类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拦截器栈"><span class="toc-number">8.4.</span> <span class="toc-text">拦截器栈</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#默认拦截器栈"><span class="toc-number">8.4.1.</span> <span class="toc-text">默认拦截器栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Struts2中的拦截器体系"><span class="toc-number">8.4.2.</span> <span class="toc-text">Struts2中的拦截器体系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义拦截器"><span class="toc-number">8.4.2.1.</span> <span class="toc-text">自定义拦截器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#默认拦截器（系统拦截器）了解"><span class="toc-number">8.4.2.2.</span> <span class="toc-text">默认拦截器（系统拦截器）了解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#默认拦截器放置的位置"><span class="toc-number">8.4.2.3.</span> <span class="toc-text">默认拦截器放置的位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#方法拦截器"><span class="toc-number">8.4.2.4.</span> <span class="toc-text">方法拦截器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拦截器的应用"><span class="toc-number">8.5.</span> <span class="toc-text">拦截器的应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#强制登陆"><span class="toc-number">8.5.1.</span> <span class="toc-text">强制登陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#防止用户重复提交（令牌环）"><span class="toc-number">8.5.2.</span> <span class="toc-text">防止用户重复提交（令牌环）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Struts2令牌环解决思路"><span class="toc-number">8.5.3.</span> <span class="toc-text">Struts2令牌环解决思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#客户端生成随机数"><span class="toc-number">8.5.3.1.</span> <span class="toc-text">客户端生成随机数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置token拦截器"><span class="toc-number">8.5.3.2.</span> <span class="toc-text">配置token拦截器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#提供跳转目标页面"><span class="toc-number">8.5.3.3.</span> <span class="toc-text">提供跳转目标页面</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#STRUTS2中的高级部分"><span class="toc-number">9.</span> <span class="toc-text">STRUTS2中的高级部分</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#上传"><span class="toc-number">9.1.</span> <span class="toc-text">上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#文件上传核心思路"><span class="toc-number">9.1.1.</span> <span class="toc-text">文件上传核心思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件上传开发步骤"><span class="toc-number">9.1.2.</span> <span class="toc-text">文件上传开发步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#客户端的处理"><span class="toc-number">9.1.2.1.</span> <span class="toc-text">客户端的处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务器端创建一个文件夹，用于保存用户上传的文件"><span class="toc-number">9.1.2.2.</span> <span class="toc-text">服务器端创建一个文件夹，用于保存用户上传的文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#处理客户端上传的文件"><span class="toc-number">9.1.2.3.</span> <span class="toc-text">处理客户端上传的文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件上传（重构）"><span class="toc-number">9.1.2.4.</span> <span class="toc-text">文件上传（重构）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IO操作过于频繁，希望简化IO的处理"><span class="toc-number">9.1.2.4.1.</span> <span class="toc-text">IO操作过于频繁，希望简化IO的处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#文件名"><span class="toc-number">9.1.2.4.2.</span> <span class="toc-text">文件名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#文件路径"><span class="toc-number">9.1.2.4.3.</span> <span class="toc-text">文件路径</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#维护性差"><span class="toc-number">9.1.2.4.4.</span> <span class="toc-text">维护性差</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Struts2中上传的文件默认大小为2M"><span class="toc-number">9.1.2.4.5.</span> <span class="toc-text">Struts2中上传的文件默认大小为2M</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下载"><span class="toc-number">9.2.</span> <span class="toc-text">下载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#文件下载的核心思路"><span class="toc-number">9.2.1.</span> <span class="toc-text">文件下载的核心思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Struts2下载的步骤"><span class="toc-number">9.2.2.</span> <span class="toc-text">Struts2下载的步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#extends-ActionSupport"><span class="toc-number">9.2.2.1.</span> <span class="toc-text">extends ActionSupport</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件下载重构（优化）"><span class="toc-number">9.2.2.2.</span> <span class="toc-text">文件下载重构（优化）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#完成路径的修改"><span class="toc-number">9.2.2.2.1.</span> <span class="toc-text">完成路径的修改</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#下载中如何处理用户需要下载的文件名字"><span class="toc-number">9.2.2.2.2.</span> <span class="toc-text">下载中如何处理用户需要下载的文件名字</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#解决用户下载之后的文件名"><span class="toc-number">9.2.2.2.3.</span> <span class="toc-text">解决用户下载之后的文件名</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/Avatar.png"></div><div class="author-info__name text-center">HibisciDai</div><div class="author-info__description text-center">HibisciDai'Blog</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">32</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">27</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">11</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://github.com/HibisciDai/hexo-theme-melody" target="_blank">HexoTheme-github</a><a class="author-info-links__name text-center" href="https://molunerfinn.com/" target="_blank">molunerfinn</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/banner2.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">HibisciDai</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/about">关于我</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span></div><div id="post-info"><div id="post-title">Struts2学习笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-03-30</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/前端/">前端</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><p>[TOC]</p>
<h1 id="Struts2框架引言"><a href="#Struts2框架引言" class="headerlink" title="Struts2框架引言"></a>Struts2框架引言</h1><h2 id="什么是框架-FrameWork"><a href="#什么是框架-FrameWork" class="headerlink" title="什么是框架(FrameWork)"></a>什么是框架(FrameWork)</h2><p>软件开发过程中的半成品，解决软件开发中的通用问题，从而提高开发效率。<br><em>eg</em>：</p>
<ul>
<li>字符集编码</li>
<li>收集数据</li>
<li>手工类型转化</li>
<li>JDBC访问</li>
</ul>
<h2 id="Struts2框架的概念"><a href="#Struts2框架的概念" class="headerlink" title="Struts2框架的概念"></a>Struts2框架的概念</h2><p>典型的MVC框架，人为的把一个软件分为3个层次从而提高开发效率。<br>M(Model | 模型层)Service + DAO + Entity<br>V(View | 视图层) JSP(freemarker velocity)<br>C(Controller | 控制层) (Servlet)</p>
<h3 id="MVC设计思想的优点"><a href="#MVC设计思想的优点" class="headerlink" title="MVC设计思想的优点"></a>MVC设计思想的优点</h3><ul>
<li>解耦合，利于代码维护</li>
<li>有利于分工，提高代码开发效率</li>
</ul>
<a id="more"></a>
<h3 id="现有的MVC控制层所存在的问题"><a href="#现有的MVC控制层所存在的问题" class="headerlink" title="现有的MVC控制层所存在的问题"></a>现有的MVC控制层所存在的问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Servlet &#123;</span><br><span class="line">	//收集数据</span><br><span class="line">	//出现问题1:设置字符集编码的代码问题</span><br><span class="line">	String age = request.getParamter(&quot;age&quot;);</span><br><span class="line">	request.getParamter(&quot;password&quot;);</span><br><span class="line"></span><br><span class="line">	//问题2:手工进行类型转换</span><br><span class="line">	Interger.parseInt();</span><br><span class="line"></span><br><span class="line">	//调用业务</span><br><span class="line">	Service</span><br><span class="line"></span><br><span class="line">	//跳转页面</span><br><span class="line">	request.getRequestDispatcher(&quot;/a.jsp&quot;).forward(request, response);</span><br><span class="line">	</span><br><span class="line">	redirect;</span><br><span class="line"></span><br><span class="line">	//问题3:把跳转路径写死在程序中，不利于代码的维护</span><br><span class="line">	response.sendredirect(&quot;/b.jsp&quot;);</span><br></pre></td></tr></table></figure>
<h3 id="Struts2的实战开发思路"><a href="#Struts2的实战开发思路" class="headerlink" title="Struts2的实战开发思路"></a>Struts2的实战开发思路</h3><p>Struts2代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Struts2 &#123;</span><br><span class="line">	MyStruts2 implements Action &#123;</span><br><span class="line">		public String execute() throws Exception &#123;</span><br><span class="line">			//调用业务</span><br><span class="line">			//调用业务</span><br><span class="line">			//跳转页面</span><br><span class="line">			return &quot;hibiscidai&quot; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对于WEBAPPLICATION的配置文件web.xml要声明映射<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">	&lt;servlet-name&gt;A&lt;/servlet-name&gt;</span><br><span class="line">	&lt;servlet-class&gt;xxx.servlet&lt;/servlet-class&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">	&lt;servlet-name&gt;A&lt;/servlet-name&gt;</span><br><span class="line">	&lt;url-pattern&gt;/A&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></p>
<p>对于Struts.xml的配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;action name=&quot;A&quot; class=&quot;xxx.action&quot;&gt;</span><br><span class="line">	&lt;result name=&quot;hibiscidai&quot;&gt;</span><br><span class="line">	&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="第一个Struts2程序的开发"><a href="#第一个Struts2程序的开发" class="headerlink" title="第一个Struts2程序的开发"></a>第一个Struts2程序的开发</h1><h2 id="搭建开发环境"><a href="#搭建开发环境" class="headerlink" title="搭建开发环境"></a>搭建开发环境</h2><h3 id="引入核心jar包"><a href="#引入核心jar包" class="headerlink" title="引入核心jar包"></a>引入核心jar包</h3><p>struts2-core-2.3.15.1.jar</p>
<h3 id="引入第三方jar包"><a href="#引入第三方jar包" class="headerlink" title="引入第三方jar包"></a>引入第三方jar包</h3><h3 id="引入Struts-xml配置文件"><a href="#引入Struts-xml配置文件" class="headerlink" title="引入Struts.xml配置文件"></a>引入Struts.xml配置文件</h3><h3 id="配置Struts2核心过滤器"><a href="#配置Struts2核心过滤器" class="headerlink" title="配置Struts2核心过滤器"></a>配置Struts2核心过滤器</h3><p>在web.xml中声明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;filter&gt;</span><br><span class="line">	&lt;filter-name&gt;struts2&lt;/filter-name&gt;</span><br><span class="line">	&lt;filter-class&gt;org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter&lt;/filter-class&gt;</span><br><span class="line">&lt;/filter&gt;</span><br><span class="line">&lt;filter-mapping&gt;</span><br><span class="line">	&lt;filter-name&gt;struts2&lt;/filter-name&gt;</span><br><span class="line">	&lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">&lt;/filter-mapping&gt;</span><br></pre></td></tr></table></figure></p>
<p>对于不同版本会有兼容问题，注意 <em>filter-class</em> 标签映射类</p>
<h2 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h2><h3 id="实现Action接口"><a href="#实现Action接口" class="headerlink" title="实现Action接口"></a>实现Action接口</h3><h3 id="配置文件配置"><a href="#配置文件配置" class="headerlink" title="配置文件配置"></a>配置文件配置</h3><p><img src="https://img-blog.csdn.net/20180325102257859?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Struts2配置文件配置"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/Struts2配置文件配置.png" alt="Struts2配置文件配置"></p>
<h3 id="ServletActionContext类的使用"><a href="#ServletActionContext类的使用" class="headerlink" title="ServletActionContext类的使用"></a>ServletActionContext类的使用</h3><p>在 <em>servlet-api.jar</em> 包中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HttpServletRequest request = ServletActionContext.getRequest();</span><br><span class="line">HttpServletResponse response =ServletActionContext.getResponse();</span><br><span class="line">HttpSession session = request.getSession();</span><br></pre></td></tr></table></figure></p>
<h3 id="Strtus2的另一种访问方式"><a href="#Strtus2的另一种访问方式" class="headerlink" title="Strtus2的另一种访问方式"></a>Strtus2的另一种访问方式</h3><p>直接在项目路径下输入action名字或者 xxx.action<br><em>eg:</em><br><code>http://localhost:8080/ProjectName/MyAction</code><br><code>http://localhost:8080/ProjectName/MyAction.action</code></p>
<h1 id="Struts2的跳转-4种-重点"><a href="#Struts2的跳转-4种-重点" class="headerlink" title="Struts2的跳转(4种|重点)"></a>Struts2的跳转(4种|重点)</h1><h2 id="Action跳转JSP"><a href="#Action跳转JSP" class="headerlink" title="Action跳转JSP"></a>Action跳转JSP</h2><h3 id="默认Forward跳转"><a href="#默认Forward跳转" class="headerlink" title="默认Forward跳转"></a>默认Forward跳转</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;action name=&quot;FirstStruts&quot; class=&quot;fancylab.hibiscidai.action.MyAction&quot;&gt;</span><br><span class="line">	&lt;result name=&quot;success&quot; type=&quot;dispatcher&quot;&gt;</span><br><span class="line">		/ok.jsp</span><br><span class="line">	&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Redirect跳转"><a href="#Redirect跳转" class="headerlink" title="Redirect跳转"></a>Redirect跳转</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;action name=&quot;FirstStruts&quot; class=&quot;fancylab.hibiscidai.action.MyAction&quot;&gt;</span><br><span class="line">	&lt;result name=&quot;success&quot; type=&quot;redirect&quot;&gt;</span><br><span class="line">		/ok.jsp</span><br><span class="line">	&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Action跳Action"><a href="#Action跳Action" class="headerlink" title="Action跳Action"></a>Action跳Action</h2><h3 id="Forward跳转"><a href="#Forward跳转" class="headerlink" title="Forward跳转"></a>Forward跳转</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;action name=&quot;A&quot; class=&quot;fancylab.hibiscidai.action.AAction&quot;&gt;</span><br><span class="line">	&lt;result name=&quot;B&quot; type=&quot;chain&quot;&gt;</span><br><span class="line">		B</span><br><span class="line">	&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br><span class="line">&lt;action name=&quot;B&quot; class=&quot;fancylab.hibiscidai.action.BAction&quot;&gt;</span><br><span class="line">	&lt;result name=&quot;success&quot;&gt;</span><br><span class="line">		/ok.jsp</span><br><span class="line">	&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Redirect跳转-1"><a href="#Redirect跳转-1" class="headerlink" title="Redirect跳转"></a>Redirect跳转</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;action name=&quot;A&quot; class=&quot;fancylab.hibiscidai.action.AAction&quot;&gt;</span><br><span class="line">	&lt;result name=&quot;B&quot; type=&quot;redirectAction&quot;&gt;</span><br><span class="line">		B</span><br><span class="line">	&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br><span class="line">&lt;action name=&quot;B&quot; class=&quot;fancylab.hibiscidai.action.BAction&quot;&gt;</span><br><span class="line">	&lt;result name=&quot;success&quot;&gt;</span><br><span class="line">		/ok.jsp</span><br><span class="line">	&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br></pre></td></tr></table></figure>
<h2 id="包-lt-PACKAGE-gt"><a href="#包-lt-PACKAGE-gt" class="headerlink" title="包 &lt; PACKAGE &gt;"></a>包 &lt; PACKAGE &gt;</h2><p>使配置文件当中的配置信息模块化，便于配置信息的管理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;package name=&quot;xxx&quot; extends=&quot;struts-default&quot;&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="命名空间-lt-NAMESPACE-gt"><a href="#命名空间-lt-NAMESPACE-gt" class="headerlink" title="命名空间 &lt; NAMESPACE &gt;"></a>命名空间 &lt; NAMESPACE &gt;</h2><p>使用户的请求模块化，便于随后过滤器的使用。</p>
<p>原 <em>web.xml</em>配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">	&lt;servlet-name&gt;A&lt;/servlet-name&gt;</span><br><span class="line">	&lt;servlet-class&gt;fancylab.hibiscidai.action.AAction&lt;/servlet-class&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">	&lt;servlet-name&gt;A&lt;/servlet-name&gt;</span><br><span class="line">	&lt;url-pattern&gt;/User/A&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">	&lt;servlet-name&gt;A&lt;/servlet-name&gt;</span><br><span class="line">	&lt;servlet-class&gt;fancylab.hibiscidai.action.AAction&lt;/servlet-class&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">	&lt;servlet-name&gt;A&lt;/servlet-name&gt;</span><br><span class="line">	&lt;url-pattern&gt;/User/B&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br><span class="line">&lt;filter&gt;</span><br><span class="line">/User/*</span><br><span class="line">&lt;/filter&gt;</span><br></pre></td></tr></table></figure></p>
<p>访问方式：localhost:[port]/ProjectName/A</p>
<p>Struts2 包空间加入后<br><em>struts.xml</em>配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;package name=&quot;user&quot; extends=&quot;strust-default&quot; namespace=&quot;/First&quot;&gt;</span><br><span class="line">	&lt;action name=&quot;A&quot; class=&quot;fancylab.hibiscidai.action.AAction&quot;&gt;</span><br><span class="line">&lt;/package&gt;</span><br><span class="line">&lt;package name=&quot;Admin&quot; extends=&quot;strust-default&quot;&gt; </span><br><span class="line">	&lt;action name=&quot;A&quot; class=&quot;fancylab.hibiscidai.action.AAction&quot;&gt;</span><br><span class="line">&lt;/package&gt;</span><br></pre></td></tr></table></figure></p>
<p>访问方式：localhost:[port]/ProjectName/namespace/A</p>
<h2 id="跨包间的跳转"><a href="#跨包间的跳转" class="headerlink" title="跨包间的跳转"></a>跨包间的跳转</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;result name=&quot;D&quot; type=&quot;chain&quot;&gt;</span><br><span class="line">	&lt;param name=&quot;namespace&quot;&gt;/second&lt;/param&gt;&lt;!--目标包的namespace--&gt;</span><br><span class="line">	&lt;param name=&quot;actionName&quot;&gt;D&lt;/param&gt;&lt;!--目标包下的目标Action--&gt;</span><br><span class="line">&lt;/result&gt;</span><br></pre></td></tr></table></figure>
<h2 id="全局跳转"><a href="#全局跳转" class="headerlink" title="全局跳转"></a>全局跳转</h2><p>当许多Action跳转到相同路径时，可以定义全局跳转，减少配置文件当中的配置信息冗余。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;global-results&gt;</span><br><span class="line">	&lt;result  name=&quot;success&quot;&gt;</span><br><span class="line">		/ok.jsp</span><br><span class="line">	&lt;/result&gt;</span><br><span class="line">&lt;/global-results&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>只在本包内有效</li>
<li>局部配置优先<h1 id="STRUTS2接收CLIENT的参数-重点"><a href="#STRUTS2接收CLIENT的参数-重点" class="headerlink" title="STRUTS2接收CLIENT的参数(重点)"></a>STRUTS2接收CLIENT的参数(重点)</h1><h2 id="收集客户端的零散数据"><a href="#收集客户端的零散数据" class="headerlink" title="收集客户端的零散数据"></a>收集客户端的零散数据</h2>login.jsp<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;</span><br><span class="line">&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; value=&quot;login&quot;&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xxxAction implements Action &#123;</span><br><span class="line">	private String username;</span><br><span class="line">	private String password;</span><br><span class="line">	</span><br><span class="line">	//setget方法</span><br><span class="line">	</span><br><span class="line">	public String execute() &#123;</span><br><span class="line">		UserService.login(username, password);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好处</p>
<ul>
<li><p>简化了收集client数据的方式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HttpServletRequest request = ServletActionContext.getRequest();</span><br><span class="line">String username = request.getParameter(&quot;username</span><br><span class="line">&quot;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于通用数据进行自动类型转换。</p>
</li>
<li>针对于post提交数据的方式，自动解决字符集编码问题。<h2 id="通过对象收集客户端的数据"><a href="#通过对象收集客户端的数据" class="headerlink" title="通过对象收集客户端的数据"></a>通过对象收集客户端的数据</h2>register.jsp<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用户名&lt;input type=&quot;text&quot; name=&quot;user.username&quot;&gt;</span><br><span class="line">密码&lt;input type=&quot;password&quot; name=&quot;user.password&quot;&gt;</span><br><span class="line">年龄&lt;input type=&quot;text&quot; name=&quot;user.age&quot;&gt;</span><br><span class="line">日期&lt;input type=&quot;date&quot; name=&quot;user.birthdate&quot;&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot;&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>User.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class User &#123;</span><br><span class="line">	private String username;</span><br><span class="line">	private String password;</span><br><span class="line">	private int age;</span><br><span class="line">	private Date birthdate;</span><br><span class="line"></span><br><span class="line">	//setter和getter方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>RegisterAction.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RegisterAction implements Action &#123;</span><br><span class="line">	private User user;</span><br><span class="line">	//setter和getter方法</span><br><span class="line">	public String execute() &#123;</span><br><span class="line">		UserService.register(user);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="通过数组或集合的形式收集客户端的数据"><a href="#通过数组或集合的形式收集客户端的数据" class="headerlink" title="通过数组或集合的形式收集客户端的数据"></a>通过数组或集合的形式收集客户端的数据</h2><ul>
<li>批量删除</li>
<li>用户勾选多个选项时<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;checkbox&quot; value=&quot;1&quot; name=&quot;a&quot;&gt;</span><br><span class="line">&lt;input type=&quot;checkbox&quot; value=&quot;2&quot; name=&quot;a&quot;&gt;</span><br><span class="line">&lt;input type=&quot;checkbox&quot; value=&quot;3&quot; name=&quot;a&quot;&gt;</span><br><span class="line"></span><br><span class="line">private List a;//以数组的形式接收数据</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="STRUTS2中ACTION的第二种开发方式"><a href="#STRUTS2中ACTION的第二种开发方式" class="headerlink" title="STRUTS2中ACTION的第二种开发方式"></a>STRUTS2中ACTION的第二种开发方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyAction extends ActionSupport</span><br></pre></td></tr></table></figure>
<h1 id="DMI（DYNAMIC-METHOD-INVOKE-动态方法调用）-实战"><a href="#DMI（DYNAMIC-METHOD-INVOKE-动态方法调用）-实战" class="headerlink" title="DMI（DYNAMIC    METHOD   INVOKE  动态方法调用）(实战)"></a>DMI（DYNAMIC    METHOD   INVOKE  动态方法调用）(实战)</h1><p>在一个Action中提供多个方法应对用户不同需求</p>
<h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><p>extends  ActionSupport(建议)<br>语法要求：DMI中Action中的方法，方法名随便写<br>修饰符   返回值   参数列表  与execute中方法保持一致</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="第一种配置"><a href="#第一种配置" class="headerlink" title="第一种配置"></a>第一种配置</h3><p><code>method</code> 标签中设置方法<br>优点：可读性好<br>缺点：配置信息冗余<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;action name=&quot;addUser&quot; class=&quot;fancylab.hibiscidai.action.UserAction&quot; method=&quot;add&quot;&gt;&lt;/action&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="第二种配置"><a href="#第二种配置" class="headerlink" title="第二种配置"></a>第二种配置</h3><p>采用通配符进行<br>优点：配置信息不再冗余<br>缺点：可读性极差<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;action name=&quot;user_&quot; class=&quot;fancylab.hibiscidai.action.UserAction&quot; method=&quot;&#123;1&#125;&quot;&gt;&lt;/action&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="STRUTS2中的数据处理机制"><a href="#STRUTS2中的数据处理机制" class="headerlink" title="STRUTS2中的数据处理机制"></a>STRUTS2中的数据处理机制</h1><p>数据处理机制：数据在网站中的流转<br><img src="https://img-blog.csdn.net/20180327174422857?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="数据处理机制-servlet-struts2"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/数据处理机制-servlet-struts2.png" alt="数据处理机制-servlet-struts2"></p>
<h2 id="OGNL表达式"><a href="#OGNL表达式" class="headerlink" title="OGNL表达式"></a>OGNL表达式</h2><p>OGNL表达式：是一种独立的表达式语言，不依赖于任何的框架<br>OGNL表达式特点： 从root区，ContextMap区取数据</p>
<h3 id="从Root区取数据"><a href="#从Root区取数据" class="headerlink" title="从Root区取数据"></a>从Root区取数据</h3><p>从Root区中取所存对象的属性值</p>
<h4 id="从Root去中取所存对象的属性值语法：直接属性名的方式"><a href="#从Root去中取所存对象的属性值语法：直接属性名的方式" class="headerlink" title="从Root去中取所存对象的属性值语法：直接属性名的方式"></a>从Root去中取所存对象的属性值语法：直接属性名的方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public   void   test1() throws  Exception&#123;</span><br><span class="line">	Person person = new  Person();</span><br><span class="line">	person.setUsername(&quot;laowang&quot;);</span><br><span class="line">	person.setPassword(&quot;12345&quot;);</span><br><span class="line">	person.setAge(30);</span><br><span class="line">	</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;username&quot;,person));</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;password&quot;,person));</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;age&quot;,person));	 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="从root区中取某一个对象中的关联对象的属性值-关联引用名-属性"><a href="#从root区中取某一个对象中的关联对象的属性值-关联引用名-属性" class="headerlink" title="从root区中取某一个对象中的关联对象的属性值:关联引用名.属性"></a>从root区中取某一个对象中的关联对象的属性值:关联引用名.属性</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public  void   test2()  throws Exception&#123;</span><br><span class="line">	Person person = new  Person();</span><br><span class="line">	person.setUsername(&quot;laowang&quot;);</span><br><span class="line">	person.setPassword(&quot;12345&quot;);</span><br><span class="line">	person.setAge(30);	  </span><br><span class="line">	Address address = new  Address();</span><br><span class="line">	</span><br><span class="line">	address.setStreet(&quot;文化路&quot;);</span><br><span class="line">	person.setAddress(address);	</span><br><span class="line">	</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;address.addressname&quot;,person));</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;address.street&quot;,person));	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="从root区中取某一个对象当中的List集合中的元素-List集合引用名-下标"><a href="#从root区中取某一个对象当中的List集合中的元素-List集合引用名-下标" class="headerlink" title="从root区中取某一个对象当中的List集合中的元素:List集合引用名[下标]"></a>从root区中取某一个对象当中的List集合中的元素:List集合引用名[下标]</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public  void   test3()  throws  Exception&#123;	</span><br><span class="line">	Person person = new  Person();</span><br><span class="line">	person.setUsername(&quot;laowang&quot;);</span><br><span class="line">	person.setPassword(&quot;12345&quot;);</span><br><span class="line">	person.setAge(30);</span><br><span class="line">	</span><br><span class="line">	List&lt;String&gt; tels = person.getTels();</span><br><span class="line">	tels.add(&quot;xjr&quot;);</span><br><span class="line">	tels.add(&quot;whp&quot;);</span><br><span class="line">	</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;tels[0]&quot;,person));</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;tels[1]&quot;,person));	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="从root区中取某一个对象当中的Map集合中的某一个元素-map集合的引用名-键"><a href="#从root区中取某一个对象当中的Map集合中的某一个元素-map集合的引用名-键" class="headerlink" title="从root区中取某一个对象当中的Map集合中的某一个元素:map集合的引用名[键]"></a>从root区中取某一个对象当中的Map集合中的某一个元素:map集合的引用名[键]</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public  void  test4() throws  Exception&#123;</span><br><span class="line">	Person person = new  Person();</span><br><span class="line">	person.setUsername(&quot;laowang&quot;);</span><br><span class="line">	person.setPassword(&quot;12345&quot;);</span><br><span class="line">	person.setAge(30);</span><br><span class="line">	Map&lt;String, String&gt; qqs = person.getQqs();</span><br><span class="line">	qqs.put(&quot;kuaige&quot;,&quot;562471794&quot;);</span><br><span class="line">	qqs.put(&quot;zpf&quot;,&quot;7654321&quot;);</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;qqs[&apos;kuaige&apos;]&quot;,person));</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;qqs[&apos;zpf&apos;]&quot;,person));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ognl表达式中的运算"><a href="#ognl表达式中的运算" class="headerlink" title="ognl表达式中的运算"></a>ognl表达式中的运算</h4><ul>
<li>算数运算 <code>+</code>  <code>-</code>  <code>*</code>  <code>/</code>   <code>%</code></li>
<li>比较运算  <code>&gt;</code>  <code>&lt;</code>   <code>&gt;=</code>   <code>&lt;=</code>  <code>!=</code></li>
<li>逻辑运算   <code>&amp;&amp;</code>  <code>||</code>  <code>!</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public  void  test5()  throws Exception&#123;</span><br><span class="line">	Person person = new  Person();</span><br><span class="line">	person.setUsername(&quot;laowang&quot;);</span><br><span class="line">	person.setPassword(&quot;12345&quot;);</span><br><span class="line">	person.setAge(30);</span><br><span class="line">	</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;age&lt;10&quot;,person));</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;username==&apos;laowang&apos;&quot;,person));	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="OGNL表达式可以调用某种数据类型的方法"><a href="#OGNL表达式可以调用某种数据类型的方法" class="headerlink" title="OGNL表达式可以调用某种数据类型的方法"></a>OGNL表达式可以调用某种数据类型的方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public   void  test6()  throws  Exception&#123;</span><br><span class="line">	Person person = new  Person();</span><br><span class="line">	person.setUsername(&quot;laowang&quot;);</span><br><span class="line">	person.setPassword(&quot;12345&quot;);</span><br><span class="line">	person.setAge(30);</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;username.toUpperCase()&quot;,person));</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;username.equals(&apos;laowang&apos;)&quot;,person));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="从ContextMap区取数据"><a href="#从ContextMap区取数据" class="headerlink" title="从ContextMap区取数据"></a>从ContextMap区取数据</h3><p>contextmap本身是个map，在单独测试ognl时需要提供一个map集合<br>语法：#key的方式取值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//ContextMap区取值的方式</span><br><span class="line">@Test</span><br><span class="line">public void  test1() throws Exception&#123;</span><br><span class="line">	Map&lt;String,Person&gt; contextmap = new HashMap&lt;String,Person&gt;();  </span><br><span class="line">	Person person = new Person();</span><br><span class="line">	person.setUsername(&quot;laowang&quot;);</span><br><span class="line">	person.setPassword(&quot;12345&quot;);</span><br><span class="line">	person.setAge(30);</span><br><span class="line">	contextmap.put(&quot;A&quot;, person);</span><br><span class="line">	System.out.println(Ognl.getValue(&quot;#A.age+10&quot;, contextmap,new Object()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="VALUESTACK"><a href="#VALUESTACK" class="headerlink" title="VALUESTACK"></a>VALUESTACK</h2><h3 id="作用：管理-存储-一次请求有效的数据"><a href="#作用：管理-存储-一次请求有效的数据" class="headerlink" title="作用：管理(存储)一次请求有效的数据"></a>作用：管理(存储)一次请求有效的数据</h3><p>1.客户端传来的数据<br>2.作用域中的数据</p>
<ul>
<li>request</li>
<li>session</li>
<li>application<h3 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h3>与视图层（view层）解耦合<h3 id="获取值栈"><a href="#获取值栈" class="headerlink" title="获取值栈"></a>获取值栈</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ActionContext ac = ActionContext.getContext();</span><br><span class="line">ValueStack vs = ac.getValueStack();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="值栈的生命周期-request作用域"><a href="#值栈的生命周期-request作用域" class="headerlink" title="值栈的生命周期(request作用域)"></a>值栈的生命周期(request作用域)</h3><p>一次请求有效，请求变化则值栈变化</p>
<h3 id="值栈的内存结构"><a href="#值栈的内存结构" class="headerlink" title="值栈的内存结构"></a>值栈的内存结构</h3><p>请求格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.setAttribute(&quot;name&quot;, &quot;laowang&quot;);</span><br><span class="line">request.getAttribute(&quot;name&quot;);</span><br><span class="line">request.setAttribute(&quot;n&quot;, &quot;feige&quot;);</span><br></pre></td></tr></table></figure></p>
<p>user类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class User &#123;</span><br><span class="line">	private String username;</span><br><span class="line">	//setter和getter方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>request作用域底层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class request &#123;</span><br><span class="line">	private Map attribute;</span><br><span class="line">	</span><br><span class="line">	public void setAttribute(String name, String object) &#123;</span><br><span class="line">		attribute.put(name, object);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public Object getAttribute(String name) &#123;</span><br><span class="line">		Object = attrbute.get(&quot;name&quot;);</span><br><span class="line">		return object;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对于作用域<br>request–map<br>session–map<br>application–map</p>
<p><em>值栈的内存结构</em><br><img src="https://img-blog.csdn.net/20180327221632321?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="值栈的内存结构"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/值栈的内存结构.png" alt="值栈的内存结构"></p>
<h3 id="值栈的注意事项"><a href="#值栈的注意事项" class="headerlink" title="值栈的注意事项"></a>值栈的注意事项</h3><p>问题：值栈是一次请求有效，为什么可以管理session  application作用域？<br><img src="https://img-blog.csdn.net/20180327221748555?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="值栈注意事项"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/值栈注意事项.png" alt="值栈注意事项"></p>
<h2 id="STRUTS中的标签-上"><a href="#STRUTS中的标签-上" class="headerlink" title="STRUTS中的标签(上)"></a>STRUTS中的标签(上)</h2><p>作用：配合值栈在视图层显示数据<br>引用：<br>JSTL标签：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</span><br></pre></td></tr></table></figure></p>
<p>Strtus标签：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot;%&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="显示数据"><a href="#显示数据" class="headerlink" title="显示数据"></a>显示数据</h3><h4 id="显示单个数据"><a href="#显示单个数据" class="headerlink" title="显示单个数据"></a>显示单个数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:property value=&quot;OGNL表达式&quot; /&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>单一流程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:if test=&quot;OGNL表达式&quot; /&gt;</span><br><span class="line">&lt;/s:if&gt;</span><br><span class="line">&lt;s:else&gt;</span><br><span class="line">&lt;/s:else&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>非单一流程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:if test=&quot;OGNL表达式&quot;&gt;</span><br><span class="line">&lt;/s:if&gt;</span><br><span class="line">&lt;s:elseif test=&quot;OGNL表达式&quot; /&gt;</span><br><span class="line">&lt;/s:elseif&gt;</span><br><span class="line">&lt;s:else&gt;</span><br><span class="line">&lt;/s:else&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="显示多个数据"><a href="#显示多个数据" class="headerlink" title="显示多个数据"></a>显示多个数据</h4><p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:iterator value=&quot;OGNL表达式&quot;&gt;</span><br><span class="line">&lt;/s:iterator&gt;</span><br></pre></td></tr></table></figure></p>
<h5 id="从数组或集合中显示数据-对象类型"><a href="#从数组或集合中显示数据-对象类型" class="headerlink" title="从数组或集合中显示数据(对象类型)"></a>从数组或集合中显示数据(对象类型)</h5><p><em>List或Set数组</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:iterator value=&quot;#request.users&quot;&gt;</span><br><span class="line">	&lt;h1&gt;&lt;s:property value=&quot;username&quot;/&gt;&lt;/h1&gt;</span><br><span class="line">	&lt;h1&gt;&lt;s:property value=&quot;password&quot;/&gt;&lt;/h1&gt;</span><br><span class="line">	&lt;h1&gt;&lt;s:property value=&quot;age&quot;/&gt;&lt;/h1&gt;</span><br><span class="line">&lt;/s:iterator&gt;</span><br></pre></td></tr></table></figure></p>
<p><em>Map</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:iterator value=&quot;#request.users&quot;&gt;</span><br><span class="line">	&lt;!--取map的键--&gt;</span><br><span class="line">	&lt;h1&gt;&lt;s:property value=&quot;key&quot;/&gt;&lt;/h1&gt;</span><br><span class="line">	&lt;h1&gt;==========&lt;/h1&gt;</span><br><span class="line">	&lt;!--取map的值--&gt;</span><br><span class="line">	&lt;h1&gt;&lt;s:property value=&quot;value&quot;/&gt;&lt;/h1&gt;</span><br><span class="line">&lt;/s:iterator&gt;</span><br></pre></td></tr></table></figure></p>
<h5 id="从数组或集合中显示数据-String类型和8种基本类型"><a href="#从数组或集合中显示数据-String类型和8种基本类型" class="headerlink" title="从数组或集合中显示数据(String类型和8种基本类型)"></a>从数组或集合中显示数据(String类型和8种基本类型)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:iterator value=&quot;#request.s&quot;&gt;</span><br><span class="line">	&lt;s:property/&gt;</span><br><span class="line">&lt;/s:iterator&gt;</span><br></pre></td></tr></table></figure>
<h5 id="遍历状态"><a href="#遍历状态" class="headerlink" title="遍历状态"></a>遍历状态</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:iterator value=&quot;OGNL&quot; status=&quot;s&quot;&gt;</span><br><span class="line">	#s.count      遍历次数</span><br><span class="line">	#s.index      遍历的下标</span><br><span class="line">	#s.odd       是否是奇数遍历</span><br><span class="line">	#s.even      是否是偶次遍历</span><br><span class="line">&lt;/s:iterator&gt;</span><br><span class="line">&lt;s:iterator value=&quot;OGNL&quot; begin=&quot;&quot; end=&quot;&quot; Step=&quot;&quot;&gt;</span><br><span class="line">&lt;/s:iterator&gt;</span><br></pre></td></tr></table></figure>
<p>begin：从某一个下标开始遍历<br>end：以某一个下标结束<br>step：步幅</p>
<p>查询所有的思路：<br><img src="https://img-blog.csdn.net/20180328220331687?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="查询所有的思路"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/查询所有的思路.png" alt="查询所有的思路"></p>
<h2 id="STRUTS2数据处理机制的补充"><a href="#STRUTS2数据处理机制的补充" class="headerlink" title="STRUTS2数据处理机制的补充"></a>STRUTS2数据处理机制的补充</h2><h3 id="Action中的成员变量替换request作用域"><a href="#Action中的成员变量替换request作用域" class="headerlink" title="Action中的成员变量替换request作用域"></a>Action中的成员变量替换request作用域</h3><p><img src="https://img-blog.csdn.net/20180328220600459?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Action中的成员变量替换request作用域"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/Action中的成员变量替换request作用域.png" alt="Action中的成员变量替换request作用域"><br>Action中成员变量的作用：</p>
<ul>
<li>收集客户端的参数（零散变量，对象，数组或集合）</li>
<li>替换request作用域<h3 id="简化值栈操作session作用域，application作用域的开发"><a href="#简化值栈操作session作用域，application作用域的开发" class="headerlink" title="简化值栈操作session作用域，application作用域的开发"></a>简化值栈操作session作用域，application作用域的开发</h3>Struts2ScopeUtil工具类的开发<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import com.opensymphony.xwork2.ActionContext;</span><br><span class="line">import com.opensymphony.xwork2.util.ValueStack;</span><br><span class="line"></span><br><span class="line">//简化值栈操作session作用域及application作用域的使用</span><br><span class="line">public class Struts2ScopeUtil &#123;</span><br><span class="line"></span><br><span class="line">	// 向session作用域中存值</span><br><span class="line">	public static void setSessionAttribute(String OGNL, Object value) &#123;</span><br><span class="line">		ActionContext context = ActionContext.getContext();</span><br><span class="line">		ValueStack valueStack = context.getValueStack();</span><br><span class="line">		valueStack.setValue(&quot;#session.&quot; + OGNL, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 从Session作用域中取值</span><br><span class="line">	public static Object getSessionAttribute(String OGNL) &#123;</span><br><span class="line">		ActionContext context = ActionContext.getContext();</span><br><span class="line">		ValueStack valueStack = context.getValueStack();</span><br><span class="line">		return valueStack.findValue(&quot;#session.&quot; + OGNL);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 向application作用域中存值</span><br><span class="line">	public static void setApplicationAttribute(String OGNL, Object value) &#123;</span><br><span class="line">		ActionContext context = ActionContext.getContext();</span><br><span class="line">		ValueStack valueStack = context.getValueStack();</span><br><span class="line">		valueStack.setValue(&quot;#application.&quot; + OGNL, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 从application作用域中取值</span><br><span class="line">	public static Object getApplicationAttribute(String OGNL) &#123;</span><br><span class="line">		ActionContext context = ActionContext.getContext();</span><br><span class="line">		ValueStack valueStack = context.getValueStack();</span><br><span class="line">		return valueStack.findValue(&quot;#application.&quot; + OGNL);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="为什么叫值栈？值栈体现在哪个区呢"><a href="#为什么叫值栈？值栈体现在哪个区呢" class="headerlink" title="为什么叫值栈？值栈体现在哪个区呢?"></a>为什么叫值栈？值栈体现在哪个区呢?</h3><p>栈：先进后出</p>
<h3 id="DEBUG使用"><a href="#DEBUG使用" class="headerlink" title="DEBUG使用"></a>DEBUG使用</h3><ul>
<li>打断点</li>
<li>tomcat以debug模式启动</li>
<li>F5进入方法内部/F6不进入方法内部，只显示程序流程/F8推出debug模式/类似于ArrayList的内存结构<br><img src="https://img-blog.csdn.net/20180328221147377?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="debug使用"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/debug使用.png" alt="debug使用"><h3 id="总结：现有STRUTS2的开发步骤"><a href="#总结：现有STRUTS2的开发步骤" class="headerlink" title="总结：现有STRUTS2的开发步骤"></a>总结：现有STRUTS2的开发步骤</h3><img src="https://img-blog.csdn.net/20180328221325880?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="debug开发步骤"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/debug开发步骤.png" alt="debug开发步骤"><h2 id="STRUTS标签-续"><a href="#STRUTS标签-续" class="headerlink" title="STRUTS标签(续)"></a>STRUTS标签(续)</h2><h3 id="lt-s-date-gt"><a href="#lt-s-date-gt" class="headerlink" title="&lt;s:date/&gt;"></a><code>&lt;s:date/&gt;</code></h3>语法：<code>&lt;s:date name=&quot;OGNL&quot; format=&quot;自定义日期类型&quot; /&gt;</code><br>作用：自定义日期的格式<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:date name=&quot;#request.date&quot; format=&quot;yyyy-MM-dd hh:mm:ss&quot; /&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="lt-s-url-gt"><a href="#lt-s-url-gt" class="headerlink" title="&lt;s:url/&gt;"></a><code>&lt;s:url/&gt;</code></h3><p>语法：<code>&lt;s:url action=&quot;&quot; namespace=&quot;&quot;/&gt;</code> 、<code>&lt;s:url value=&quot;&quot;/&gt;</code><br>作用：防止用户禁用Cookie，自动进行url重写。加载第三方资源。<br>注意：传值<code>&lt;s:url action=&quot;&quot; namespace=&quot;&quot;/&gt;?id=41</code> </p>
<h3 id="s标签中与html相关的UI标签"><a href="#s标签中与html相关的UI标签" class="headerlink" title="s标签中与html相关的UI标签"></a>s标签中与html相关的UI标签</h3><p><code>&lt;s:form&gt;&lt;/s:form&gt;</code>———-&gt;<code>&lt;form&gt;&lt;/form&gt;</code><br><code>&lt;s:head/&gt;</code> ———-&gt;<code>&lt;head&gt;&lt;/head&gt;</code><br><code>&lt;s:text name=&quot;&quot;&gt;&lt;/s:text&gt;</code>———-&gt;<code>&lt;input type=&quot;text&quot;/&gt;</code><br><code>&lt;s:date name=&quot;&quot;/&gt;</code>———-&gt;<code>&lt;input type=&quot;date&quot;/&gt;</code></p>
<h3 id="lt-s-action-gt"><a href="#lt-s-action-gt" class="headerlink" title="&lt;s:action /&gt;"></a><code>&lt;s:action /&gt;</code></h3><p>语法：<code>&lt;s:action name=&quot;&quot; namespace=&quot;&quot; executeResult=&quot;&quot; /&gt;</code><br>作用：把多个Action的处理结果作整合</p>
<h3 id="针对于前台视图"><a href="#针对于前台视图" class="headerlink" title="针对于前台视图"></a>针对于前台视图</h3><p>传统思路<br><img src="https://img-blog.csdn.net/20180329214242443?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="传统首页显示方式"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/传统首页显示方式.png" alt="传统首页显示方式"><br>Struts解决方案<br><img src="https://img-blog.csdn.net/20180329214253159?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Struts解决前台首页"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/Struts解决前台首页.png" alt="Struts解决前台首页"></p>
<h1 id="STRUTS2中的拦截器"><a href="#STRUTS2中的拦截器" class="headerlink" title="STRUTS2中的拦截器"></a>STRUTS2中的拦截器</h1><h2 id="拦截器的作用：把多个ACTION中的冗余代码，抽取到拦截器中，解决代码冗余问题"><a href="#拦截器的作用：把多个ACTION中的冗余代码，抽取到拦截器中，解决代码冗余问题" class="headerlink" title="拦截器的作用：把多个ACTION中的冗余代码，抽取到拦截器中，解决代码冗余问题"></a>拦截器的作用：把多个ACTION中的冗余代码，抽取到拦截器中，解决代码冗余问题</h2><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="编码implements-Interceptor接口"><a href="#编码implements-Interceptor接口" class="headerlink" title="编码implements  Interceptor接口"></a>编码implements  Interceptor接口</h3><ul>
<li>方法作用：<br>把多个Action中的冗余代码，写入次方法中，解决代码冗余问题</li>
<li>参数的作用：<br><code>ai.getAction();</code>//获取目标的Action<br><code>ai.getStack();</code>//获取值栈<br><code>ai.invoke();</code>//控制请求的流程走向</li>
<li>返回值的作用：<br>中断用户请求时，指向跳转的目标JSP页面<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class checkloginInterceptor extends AbstractInterceptor &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public String intercept(ActionInvocation ai) throws Exception &#123;</span><br><span class="line">		// 获取登陆或注册的标志位</span><br><span class="line">		String flag = (String) Struts2ScopeUtil.getSessionAttribute(&quot;flag&quot;);</span><br><span class="line">		if (flag == null) &#123;</span><br><span class="line">			return &quot;login&quot;;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			ai.invoke();</span><br><span class="line">		&#125;</span><br><span class="line">		return null;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;interceptors&gt;</span><br><span class="line">	&lt;interceptor name=&quot;myInterceptor&quot; class=&quot;fancylab.hibiscidai.interceptor.MyInterceptor&quot;&gt;</span><br><span class="line">&lt;/interceptors&gt;</span><br><span class="line">&lt;action name=&quot;A&quot; class=&quot;fancylab.hibiscidai.action.AAction&quot; method=&quot;A&quot;&gt;</span><br><span class="line">	&lt;interceptor-ref name=myinterceptor&quot;&gt;&lt;/interceptor-ref&gt;</span><br><span class="line">&lt;/action&gt;</span><br></pre></td></tr></table></figure>
<h2 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h2><h3 id="拦截响应"><a href="#拦截响应" class="headerlink" title="拦截响应"></a>拦截响应</h3><p><img src="https://img-blog.csdn.net/2018033021481617?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Struts2拦截响应"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/Struts2拦截响应.png" alt="Struts2拦截响应"></p>
<h3 id="中断请求"><a href="#中断请求" class="headerlink" title="中断请求"></a>中断请求</h3><p><img src="https://img-blog.csdn.net/20180330215345741?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Struts2中断请求"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/Struts2中断请求.png" alt="Struts2中断请求"></p>
<h3 id="拦截器只在本包中有效"><a href="#拦截器只在本包中有效" class="headerlink" title="拦截器只在本包中有效"></a>拦截器只在本包中有效</h3><h3 id="简化拦截器开发-继承AbstractInterceptor类"><a href="#简化拦截器开发-继承AbstractInterceptor类" class="headerlink" title="简化拦截器开发  继承AbstractInterceptor类"></a>简化拦截器开发  继承AbstractInterceptor类</h3><h2 id="拦截器栈"><a href="#拦截器栈" class="headerlink" title="拦截器栈"></a>拦截器栈</h2><p>作用：管理多个拦截器<br>使用：不编码，只需配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--拦截器栈--&gt;</span><br><span class="line">&lt;interceptor-stack name=&quot;my&quot;&gt;</span><br><span class="line">	&lt;interceptor-ref name=&quot;myInterceptor&quot;&gt;&lt;/interceptor-ref&gt;</span><br><span class="line">	&lt;interceptor-ref name=&quot;myInterceptor2&quot;&gt;&lt;/interceptor-ref&gt;</span><br><span class="line">&lt;/interceptor-stack&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="默认拦截器栈"><a href="#默认拦截器栈" class="headerlink" title="默认拦截器栈"></a>默认拦截器栈</h3><p>作用：可以指定一个拦截器栈为默认拦截器栈，可以拦截所有的目标Action<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;default-interceptor-ref name=&quot;my&quot;&gt;&lt;/default-interceptor-ref&gt;</span><br></pre></td></tr></table></figure></p>
<p>注意：默认拦截器栈放置的位置必须在全局跳转的前边，每个包中只能配置一个默认拦截器，局部配置优先。</p>
<h3 id="Struts2中的拦截器体系"><a href="#Struts2中的拦截器体系" class="headerlink" title="Struts2中的拦截器体系"></a>Struts2中的拦截器体系</h3><h4 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h4><h4 id="默认拦截器（系统拦截器）了解"><a href="#默认拦截器（系统拦截器）了解" class="headerlink" title="默认拦截器（系统拦截器）了解"></a>默认拦截器（系统拦截器）了解</h4><ul>
<li>params<br>目的：接收客户端的请求参数<br><img src="https://img-blog.csdn.net/20180330221144209?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="param拦截器"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/param拦截器.png" alt="param拦截器"></li>
<li>fileupload</li>
<li>Exception</li>
<li>workflow<h4 id="默认拦截器放置的位置"><a href="#默认拦截器放置的位置" class="headerlink" title="默认拦截器放置的位置"></a>默认拦截器放置的位置</h4>Struts2-core.jar  —-&gt;Struts-default.xml<br><img src="https://img-blog.csdn.net/2018033022140593?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Struts-default.xml"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/Struts-default.xml.png" alt="Struts-default.xml"><br>注意：如果自定义了默认拦截器栈，Struts2中的系统拦截器栈将失效<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;interceptors&gt;</span><br><span class="line">&lt;interceptor-stack name=&quot;my&quot;&gt;</span><br><span class="line">	&lt;interceptor-ref name=&quot;defalutStack&quot;&gt;&lt;/interceptor-ref&gt;&lt;!--引入系统拦截器--&gt;</span><br><span class="line">	&lt;interceptor-ref name=&quot;myInterceptor&quot;&gt;&lt;/interceptor-ref&gt;</span><br><span class="line">	&lt;interceptor-ref name=&quot;myInterceptor2&quot;&gt;&lt;/interceptor-ref&gt;</span><br><span class="line">&lt;/interceptor-stack&gt;</span><br><span class="line">&lt;/interceptors&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意：如果自定义拦截器，系统拦截器将失效</p>
<h4 id="方法拦截器"><a href="#方法拦截器" class="headerlink" title="方法拦截器"></a>方法拦截器</h4><ul>
<li>作用<br>在DMI中，如果使用者采用的是通配符的配置方式，可以通过方法拦截器，拦截对应的方法。</li>
<li><p>编码<br>extends   MethodFilterInterceptor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class MethodInterceptor extends MethodFilterInterceptor  &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public String doIntercept(ActionInvocation ai) throws Exception &#123;</span><br><span class="line">		System.out.println(&quot;我是方法拦截器&quot;);</span><br><span class="line">		ai.invoke();</span><br><span class="line">		return null;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置<br>拦截排除某些方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;param name=&quot;includeMethod&quot;&gt;</span><br><span class="line">拦截器拦截哪些方法</span><br><span class="line">&lt;/param&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;interceptors&gt;</span><br><span class="line">   &lt;interceptor name=&quot;methodinterceptor&quot; class=&quot;fancylab.hibiscidai.interceptor.MethodInterceptor&quot;&gt;</span><br><span class="line">    &lt;param name=&quot;excludeMethods&quot;&gt;</span><br><span class="line">	    m4</span><br><span class="line">    &lt;/param&gt;</span><br><span class="line">   &lt;/interceptor&gt;</span><br><span class="line">   &lt;interceptor-stack name=&quot;my&quot;&gt;</span><br><span class="line">    &lt;interceptor-ref name=&quot;defaultStack&quot;&gt;&lt;/interceptor-ref&gt;</span><br><span class="line">       &lt;interceptor-ref name=&quot;methodinterceptor&quot;&gt;&lt;/interceptor-ref&gt;</span><br><span class="line">   &lt;/interceptor-stack&gt;</span><br><span class="line"> &lt;/interceptors&gt;</span><br><span class="line"> &lt;defalut-interceptor-ref name=&quot;my&quot;&gt;</span><br><span class="line"> &lt;/defalut-interceptor-ref&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意<br><img src="https://img-blog.csdn.net/20180330223024717?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="拦截器注意事项"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/拦截器注意事项.png" alt="拦截器注意事项"></li>
<li>总结<br>拦截器的开发步骤<br><img src="https://img-blog.csdn.net/20180330223129670?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="拦截器的开发步骤"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/拦截器的开发步骤.png" alt="拦截器的开发步骤"><h2 id="拦截器的应用"><a href="#拦截器的应用" class="headerlink" title="拦截器的应用"></a>拦截器的应用</h2><h3 id="强制登陆"><a href="#强制登陆" class="headerlink" title="强制登陆"></a>强制登陆</h3><img src="https://img-blog.csdn.net/20180330223420565?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Struts2强制登录"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/Struts2强制登录.png" alt="Struts2强制登录"><h3 id="防止用户重复提交（令牌环）"><a href="#防止用户重复提交（令牌环）" class="headerlink" title="防止用户重复提交（令牌环）"></a>防止用户重复提交（令牌环）</h3></li>
<li>发生场景<br>在用户进行表单提交时，因为网络通信等问题，产生重复的表单提交</li>
<li>解决方案<br>令牌环</li>
<li>令牌环实现原理<br><img src="https://img-blog.csdn.net/20180330223739678?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="令牌环实现原理"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/令牌环实现原理.png" alt="令牌环实现原理"><h3 id="Struts2令牌环解决思路"><a href="#Struts2令牌环解决思路" class="headerlink" title="Struts2令牌环解决思路"></a>Struts2令牌环解决思路</h3><h4 id="客户端生成随机数"><a href="#客户端生成随机数" class="headerlink" title="客户端生成随机数"></a>客户端生成随机数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:token&gt;&lt;/s:token&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="配置token拦截器"><a href="#配置token拦截器" class="headerlink" title="配置token拦截器"></a>配置token拦截器</h4><p>引入Struts2提供的token拦截器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;interceptor-stack name=&quot;my1&quot;&gt;</span><br><span class="line">	&lt;interceptor-ref name=&quot;token&quot;&gt;&lt;/interceptor-ref&gt;</span><br><span class="line">	&lt;interceptor-ref name=&quot;defaultStack&quot;&gt;&lt;/interceptor-ref&gt;</span><br><span class="line">&lt;/interceptor-stack&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="提供跳转目标页面"><a href="#提供跳转目标页面" class="headerlink" title="提供跳转目标页面"></a>提供跳转目标页面</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;result name=&quot;invalid.token&quot;&gt;</span><br><span class="line">	/error.jsp</span><br><span class="line">&lt;/result&gt;</span><br></pre></td></tr></table></figure>
<h1 id="STRUTS2中的高级部分"><a href="#STRUTS2中的高级部分" class="headerlink" title="STRUTS2中的高级部分"></a>STRUTS2中的高级部分</h1><h2 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h2><h3 id="文件上传核心思路"><a href="#文件上传核心思路" class="headerlink" title="文件上传核心思路"></a>文件上传核心思路</h3><ul>
<li>client问题</li>
<li>服务器端如何获得文件上传的内容</li>
<li>服务器端如何存储文件上传的内容<br><img src="https://img-blog.csdn.net/20180330224932279?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Struts2文件上传思路"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/Struts2文件上传思路.png" alt="Struts2文件上传思路"><h3 id="文件上传开发步骤"><a href="#文件上传开发步骤" class="headerlink" title="文件上传开发步骤"></a>文件上传开发步骤</h3><h4 id="客户端的处理"><a href="#客户端的处理" class="headerlink" title="客户端的处理"></a>客户端的处理</h4><code>enctype=&quot;application/x-www-form-urlencoded&quot;</code> 把表单中的文本中的内容，提交到服务器中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=&quot;post&quot; action=&quot;&quot; enctype=&quot;application/x-www-form-urlencoded&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>enctype=&quot;multipart/form-data&quot;</code> 告知服务器端识别客户端传入的文件内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=&quot;post&quot; action=&quot;&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">	&lt;input type=&quot;file&quot; name=&quot;upload&quot; /&gt;</span><br><span class="line">	&lt;input type=&quot;submit&quot; value=&quot;上传&quot; /&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="服务器端创建一个文件夹，用于保存用户上传的文件"><a href="#服务器端创建一个文件夹，用于保存用户上传的文件" class="headerlink" title="服务器端创建一个文件夹，用于保存用户上传的文件"></a>服务器端创建一个文件夹，用于保存用户上传的文件</h4><h4 id="处理客户端上传的文件"><a href="#处理客户端上传的文件" class="headerlink" title="处理客户端上传的文件"></a>处理客户端上传的文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">public class uploadAction extends ActionSupport &#123;</span><br><span class="line">	private File upload;</span><br><span class="line">	// 获取客户端传入的文件名和后缀</span><br><span class="line">	private String uploadFileName;</span><br><span class="line">	// 获取客户端传入的文件类型</span><br><span class="line">	private String uploadContentType;</span><br><span class="line"></span><br><span class="line">	// 文件存放的目录</span><br><span class="line">	private String directory;</span><br><span class="line"></span><br><span class="line">	public String getDirectory() &#123;</span><br><span class="line">		return directory;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setDirectory(String directory) &#123;</span><br><span class="line">		this.directory = directory;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String getUploadContentType() &#123;</span><br><span class="line">		return uploadContentType;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setUploadContentType(String uploadContentType) &#123;</span><br><span class="line">		this.uploadContentType = uploadContentType;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String getUploadFileName() &#123;</span><br><span class="line">		return uploadFileName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setUploadFileName(String uploadFileName) &#123;</span><br><span class="line">		this.uploadFileName = uploadFileName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public File getUpload() &#123;</span><br><span class="line">		return upload;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setUpload(File upload) &#123;</span><br><span class="line">		this.upload = upload;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String upload() &#123;</span><br><span class="line">		/*InputStream is = null;</span><br><span class="line">		OutputStream os = null;</span><br><span class="line">		// 把文件读入IO流</span><br><span class="line">		try &#123;</span><br><span class="line">			is = new FileInputStream(upload);</span><br><span class="line">			// 把文件写出到文件系统中</span><br><span class="line">			os = new FileOutputStream(&quot;D:\\Class3\\apache-tomcat-7.0.67\\webapps\\Strutspratice\\upload\\zkf.txt&quot;);</span><br><span class="line">			byte[] buffer = new byte[1024];</span><br><span class="line">			int len = 0;</span><br><span class="line">			while (true) &#123;</span><br><span class="line">				// 读操作</span><br><span class="line">				len = is.read(buffer, 0, buffer.length);</span><br><span class="line">				if (len == -1)</span><br><span class="line">					break;</span><br><span class="line">				// 写操作</span><br><span class="line">				os.write(buffer, 0, len);</span><br><span class="line">			&#125;</span><br><span class="line">			return &quot;uploadOK&quot;;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			// TODO Auto-generated catch block</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			return &quot;uploadError&quot;;</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				// 关闭流</span><br><span class="line">				is.close();</span><br><span class="line">				os.close();</span><br><span class="line">			&#125; catch (IOException e) &#123;</span><br><span class="line">				// TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;*/</span><br><span class="line">		try &#123;</span><br><span class="line">			System.out.println(uploadContentType);</span><br><span class="line">			System.out.println(directory);</span><br><span class="line">			FileUtils.copyFile(upload, new File(getRealPath(directory) + &quot;\\&quot; + uploadFileName));</span><br><span class="line">			return &quot;uploadOK&quot;;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			// TODO Auto-generated catch block</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			return &quot;uploadError&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String getRealPath(String path) &#123;</span><br><span class="line">		ServletContext servletContext = ServletActionContext.getServletContext();</span><br><span class="line">		// 获取绝对路径</span><br><span class="line">		String realPath = servletContext.getRealPath(path);</span><br><span class="line">		return realPath;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="文件上传（重构）"><a href="#文件上传（重构）" class="headerlink" title="文件上传（重构）"></a>文件上传（重构）</h4><h5 id="IO操作过于频繁，希望简化IO的处理"><a href="#IO操作过于频繁，希望简化IO的处理" class="headerlink" title="IO操作过于频繁，希望简化IO的处理"></a>IO操作过于频繁，希望简化IO的处理</h5><p><code>Commons-io.jar</code>  提供文件操作的工具类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileUtils.copyFile(upload, new File(getRealPath(directory) + &quot;\\&quot; + uploadFileName));</span><br></pre></td></tr></table></figure></p>
<h5 id="文件名"><a href="#文件名" class="headerlink" title="文件名"></a>文件名</h5><p>如何获得用户上传的文件名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private File upload;</span><br><span class="line">// 获取客户端传入的文件名和后缀</span><br><span class="line">private String uploadFileName;</span><br><span class="line">// 获取客户端传入的文件类型</span><br><span class="line">private String uploadContentType;</span><br></pre></td></tr></table></figure></p>
<h5 id="文件路径"><a href="#文件路径" class="headerlink" title="文件路径"></a>文件路径</h5><p>如何在web开发中通过相对路径获取绝对路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ServletContext sc = ServletActionContext.getServletContext();</span><br><span class="line">String RealPath = ac.getRealPath(“相对路径”);</span><br><span class="line">String RealPath = ac.getRealPath(“/upload”);</span><br></pre></td></tr></table></figure></p>
<h5 id="维护性差"><a href="#维护性差" class="headerlink" title="维护性差"></a>维护性差</h5><p>文件目录转移到配置文件中进行配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;action name=&quot;upload&quot; class=&quot;fancylab.hibiscidai.Action.uploadAction&quot; method=&quot;upload&quot;&gt;</span><br><span class="line">	&lt;param name=&quot;directory&gt;/upload&lt;/param&gt;</span><br><span class="line">&lt;/action&gt;</span><br></pre></td></tr></table></figure></p>
<p>Action中声明成员变量即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private String directory;</span><br></pre></td></tr></table></figure></p>
<h5 id="Struts2中上传的文件默认大小为2M"><a href="#Struts2中上传的文件默认大小为2M" class="headerlink" title="Struts2中上传的文件默认大小为2M"></a>Struts2中上传的文件默认大小为2M</h5><p><img src="https://img-blog.csdn.net/20180330230446373?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Struts2中上传的文件默认大小"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/Struts2中上传的文件默认大小.png" alt="Struts2中上传的文件默认大小"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--指定Struts2中 文件上传大小的上限--&gt;</span><br><span class="line">&lt;constant name=&quot;struts.multipart.maxSize&quot; value=&quot;2097152000&quot;&gt;&lt;/constant&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>/struts-2.3.15.1/docs/WW/docs/stream-result.html        stream-result</p>
<h3 id="文件下载的核心思路"><a href="#文件下载的核心思路" class="headerlink" title="文件下载的核心思路"></a>文件下载的核心思路</h3><p><img src="https://img-blog.csdn.net/20180330230737927?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqNzQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Struts2文件下载核心思路"><br><img src="/2018/03/30/2018-03-30-Struts2学习笔记/Struts2文件下载核心思路.png" alt="Struts2文件下载核心思路"></p>
<h3 id="Struts2下载的步骤"><a href="#Struts2下载的步骤" class="headerlink" title="Struts2下载的步骤"></a>Struts2下载的步骤</h3><h4 id="extends-ActionSupport"><a href="#extends-ActionSupport" class="headerlink" title="extends ActionSupport"></a>extends ActionSupport</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//目的告知Struts2将要下载的文件</span><br><span class="line">public InputStream getInputStream() throws Exception &#123;</span><br><span class="line">	return new FileInputStream(getRealPath(directory) + &quot;\\&quot; + filename);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;result type=&quot;stream&quot;&gt;</span><br><span class="line">	&lt;!-- 指定文件下载类型 --&gt;</span><br><span class="line">	&lt;param name=&quot;contentType&quot;&gt;text/plain&lt;/param&gt;</span><br><span class="line">	&lt;!-- inline代表浏览器下载之后直接打开 attachment以附件的形式进行下载 filename下载之后的文件名 --&gt;</span><br><span class="line">	&lt;param name=&quot;contentDisposition&quot;&gt;attachment;filename=$&#123;filename&#125;&lt;/param&gt;</span><br><span class="line">&lt;/result&gt;</span><br></pre></td></tr></table></figure>
<h4 id="文件下载重构（优化）"><a href="#文件下载重构（优化）" class="headerlink" title="文件下载重构（优化）"></a>文件下载重构（优化）</h4><h5 id="完成路径的修改"><a href="#完成路径的修改" class="headerlink" title="完成路径的修改"></a>完成路径的修改</h5><p>通过<code>getRealPath()</code>方法与Action中为成员变量赋值的方式，完成路径的修改。</p>
<h5 id="下载中如何处理用户需要下载的文件名字"><a href="#下载中如何处理用户需要下载的文件名字" class="headerlink" title="下载中如何处理用户需要下载的文件名字"></a>下载中如何处理用户需要下载的文件名字</h5><p>客户通过传递参数的形式，向Action中传递数据，Action中通过成员变量接收数据。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">	&lt;li&gt;</span><br><span class="line">		&lt;a href=&quot;&lt;s:url action=&apos;download&apos; namespace=&apos;/user&apos; /&gt;?filename=z.txt&quot;&gt;</span><br><span class="line">			z.txt</span><br><span class="line">		&lt;/a&gt;</span><br><span class="line">	&lt;/li&gt;</span><br><span class="line">	&lt;li&gt;</span><br><span class="line">		&lt;a href=&quot;&lt;s:url action=&apos;download&apos; namespace=&apos;/user&apos; /&gt;?filename=zkf.txt&quot;&gt;</span><br><span class="line">			zkf.txt</span><br><span class="line">		&lt;/a&gt;</span><br><span class="line">	&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//获取客户端所要下载的文件名</span><br><span class="line">private String filename;</span><br></pre></td></tr></table></figure>
<h5 id="解决用户下载之后的文件名"><a href="#解决用户下载之后的文件名" class="headerlink" title="解决用户下载之后的文件名"></a>解决用户下载之后的文件名</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//获取客户端所要下载的文件名</span><br><span class="line">private String filename;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;action name=&quot;download&quot; class=&quot;com.baizhi.Action.downloadAction&quot;&gt;</span><br><span class="line">	&lt;param name=&quot;directory&quot;&gt;/upload&lt;/param&gt;</span><br><span class="line">	&lt;result type=&quot;stream&quot;&gt;</span><br><span class="line">		&lt;!-- 指定文件下载类型 --&gt;</span><br><span class="line">		&lt;param name=&quot;contentType&quot;&gt;text/plain&lt;/param&gt;</span><br><span class="line">		&lt;!-- inline代表浏览器下载之后直接打开 attachment以附件的形式进行下载 filename下载之后的文件名 --&gt;</span><br><span class="line">		&lt;param name=&quot;contentDisposition&quot;&gt; attachment;filename=$&#123;filename&#125;&lt;/param&gt;</span><br><span class="line">	&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">HibisciDai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://hibiscidai.com/2018/03/30/2018-03-30-Struts2学习笔记/">http://hibiscidai.com/2018/03/30/2018-03-30-Struts2学习笔记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hibiscidai.com" target="_blank">HibisciDai</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/框架/">框架</a><a class="post-meta__tags" href="/tags/Struts2/">Struts2</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/zhifubaodashang.jpg"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/weixin.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share" data-disabled="linkedin,diandian"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/03/30/HibisciDais-Blog-Hello-World/"><i class="fa fa-chevron-left">  </i><span>HibisciDai's Blog Hello World</span></a></div><div class="next-post pull-right"><a href="/2018/03/19/hello-world/"><span>Hello World</span><i class="fa fa-chevron-right"></i></a></div></nav><div class="post-adv"></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'b4cf082ba9c07efb0731',
  clientSecret: 'd8c50eabb83a1ea202ed02f3cec43fb84c9ea2b8',
  repo: 'HibisciDai.github.io',
  owner: 'HibisciDai',
  admin: 'HibisciDai',
  id: md5(decodeURI(location.pathname))
})
gitalk.render('gitalk-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2018 By HibisciDai</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.1"></script><script src="/js/fancybox.js?version=1.5.1"></script><script src="/js/sidebar.js?version=1.5.1"></script><script src="/js/copy.js?version=1.5.1"></script><script src="/js/fireworks.js?version=1.5.1"></script><script src="/js/transition.js?version=1.5.1"></script><script src="/js/scroll.js?version=1.5.1"></script><script src="/js/head.js?version=1.5.1"></script></body></html>