<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Mongodb学习笔记"><meta name="keywords" content="Mongodb,集群"><meta name="author" content="HibisciDai,undefined"><meta name="copyright" content="HibisciDai"><title>Mongodb学习笔记 | HibisciDai</title><link rel="shortcut icon" href="/img/Avatar.png"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.1"><link rel="manifest" href="/manifest.json"><script>var GLOBAL = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: {"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}"},"path":"search.xml"}
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#大数据前言"><span class="toc-number">1.</span> <span class="toc-text">大数据前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#大数据概念"><span class="toc-number">1.1.</span> <span class="toc-text">大数据概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#大数据特点"><span class="toc-number">1.2.</span> <span class="toc-text">大数据特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#大数据应用场景"><span class="toc-number">1.3.</span> <span class="toc-text">大数据应用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#集群（群集）Cluster"><span class="toc-number">2.</span> <span class="toc-text">集群（群集）Cluster</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#概念"><span class="toc-number">2.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#作用"><span class="toc-number">2.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#集群分类"><span class="toc-number">2.3.</span> <span class="toc-text">集群分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主备集群-Master-Standby"><span class="toc-number">2.3.1.</span> <span class="toc-text">主备集群(Master-Standby)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主从集群-Master-slave"><span class="toc-number">2.3.2.</span> <span class="toc-text">主从集群(Master-slave)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#负载均衡集群"><span class="toc-number">2.3.3.</span> <span class="toc-text">负载均衡集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#高性能计算集群"><span class="toc-number">2.3.4.</span> <span class="toc-text">高性能计算集群</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB"><span class="toc-number">3.</span> <span class="toc-text">MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">3.1.</span> <span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主要功能特性"><span class="toc-number">3.1.1.</span> <span class="toc-text">主要功能特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优势"><span class="toc-number">3.1.2.</span> <span class="toc-text">优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#适用场景"><span class="toc-number">3.1.3.</span> <span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用限制"><span class="toc-number">3.1.4.</span> <span class="toc-text">使用限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB与关系型数据库对比"><span class="toc-number">3.1.5.</span> <span class="toc-text">MongoDB与关系型数据库对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB的安装"><span class="toc-number">3.2.</span> <span class="toc-text">MongoDB的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#启动MongoDB服务端"><span class="toc-number">3.2.1.</span> <span class="toc-text">启动MongoDB服务端:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB命令参数说明"><span class="toc-number">3.2.2.</span> <span class="toc-text">MongoDB命令参数说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB命令参数说明-1"><span class="toc-number">3.2.3.</span> <span class="toc-text">MongoDB命令参数说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB数据库基本命令"><span class="toc-number">3.2.4.</span> <span class="toc-text">MongoDB数据库基本命令:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB操作集合（Collection-相关操作"><span class="toc-number">3.2.5.</span> <span class="toc-text">MongoDB操作集合（Collection)相关操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB操作文档-Document-相关操作"><span class="toc-number">3.2.6.</span> <span class="toc-text">MongoDB操作文档(Document)相关操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB查询相关操作"><span class="toc-number">3.2.7.</span> <span class="toc-text">MongoDB查询相关操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB的索引"><span class="toc-number">3.3.</span> <span class="toc-text">MongoDB的索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#概念-1"><span class="toc-number">3.3.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#普通索引相关命令"><span class="toc-number">3.3.2.</span> <span class="toc-text">普通索引相关命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#唯一索引相关命令"><span class="toc-number">3.3.3.</span> <span class="toc-text">唯一索引相关命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB的复制"><span class="toc-number">3.4.</span> <span class="toc-text">MongoDB的复制</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/Avatar.png"></div><div class="author-info__name text-center">HibisciDai</div><div class="author-info__description text-center">HibisciDai'Blog</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">34</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">33</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">13</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://github.com/HibisciDai/hexo-theme-melody" target="_blank">HexoTheme-github</a><a class="author-info-links__name text-center" href="https://molunerfinn.com/" target="_blank">molunerfinn</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/banner2.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">HibisciDai</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/about">关于我</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/gallery">相册</a></span></div><div id="post-info"><div id="post-title">Mongodb学习笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-21</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/架构框架/">架构框架</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">2,031</span><span class="post-meta__separator">|</span><span>阅读时长: 7 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><p>[TOC]</p>
<h1 id="大数据前言"><a href="#大数据前言" class="headerlink" title="大数据前言"></a>大数据前言</h1><h2 id="大数据概念"><a href="#大数据概念" class="headerlink" title="大数据概念"></a>大数据概念</h2><p>“大数据”(big  data)是一个体量特别大,数据类别特别大的数据集。</p>
<h2 id="大数据特点"><a href="#大数据特点" class="headerlink" title="大数据特点"></a>大数据特点</h2><ul>
<li>容量（Volume）：  数据的大小决定所考虑的数据的价值和潜在的信息</li>
<li>种类（Variety）： 数据类型的多样性</li>
<li>速度（Velocity）：指获得数据的速度</li>
<li>真实性（Veracity）：数据的质量 </li>
<li>价值（Value）：合理运用大数据，以低成本创造高价值</li>
</ul>
<h2 id="大数据应用场景"><a href="#大数据应用场景" class="headerlink" title="大数据应用场景"></a>大数据应用场景</h2><ul>
<li>医疗大数据  看病更高效</li>
<li>零售大数据  最懂消费者</li>
<li>电商大数据      精准营销法宝</li>
<li>农牧大数据      量化生产</li>
<li>交通大数据      畅通出行</li>
<li>教育大数据      因材施教</li>
<li>环保大数据      对抗PM2.5</li>
<li>食品大数据      舌尖上的安全</li>
</ul>
<a id="more"></a>
<h1 id="集群（群集）Cluster"><a href="#集群（群集）Cluster" class="headerlink" title="集群（群集）Cluster"></a>集群（群集）Cluster</h1><p><img src="/2018/04/21/2018-4-21-Mongodb学习笔记/集群总述.png" alt="集群总述"></p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>多台计算机（服务器），一起对外提供服务</p>
<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><ol>
<li>更加可靠（Hight Avaliable 高可用）</li>
<li>解决单机硬件的物理上限</li>
<li>超级运算（超算）军工 科研</li>
</ol>
<h2 id="集群分类"><a href="#集群分类" class="headerlink" title="集群分类"></a>集群分类</h2><h3 id="主备集群-Master-Standby"><a href="#主备集群-Master-Standby" class="headerlink" title="主备集群(Master-Standby)"></a>主备集群(Master-Standby)</h3><p><img src="/2018/04/21/2018-4-21-Mongodb学习笔记/主备集群-Master-Standby.png" alt="主备集群"></p>
<h3 id="主从集群-Master-slave"><a href="#主从集群-Master-slave" class="headerlink" title="主从集群(Master-slave)"></a>主从集群(Master-slave)</h3><p><img src="/2018/04/21/2018-4-21-Mongodb学习笔记/主从集群-Master-slave.png" alt="主从集群"></p>
<h3 id="负载均衡集群"><a href="#负载均衡集群" class="headerlink" title="负载均衡集群"></a>负载均衡集群</h3><h3 id="高性能计算集群"><a href="#高性能计算集群" class="headerlink" title="高性能计算集群"></a>高性能计算集群</h3><h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><p><a href="https://www.mongodb.com/" target="_blank" rel="noopener">MongoDB的主页</a></p>
<p><strong>MongoDB是一个高性能，开源，无模式的文档型NoSQL数据。</strong></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="主要功能特性"><a href="#主要功能特性" class="headerlink" title="主要功能特性"></a>主要功能特性</h3><ol>
<li>文件存储格式为BSON（一种JSON的扩展）</li>
<li>模式自由</li>
<li>支持动态查询</li>
<li>支持完全索引</li>
<li>支持复制和故障恢复</li>
<li>使用高效的二进制数据存储，包括大型对象（如视频等）</li>
<li>自动处理碎片，以支持云计算层次的扩展性 </li>
<li>支持JAVA,RUBY，PYTHON，C++，PHP等多种语言</li>
<li>内部支持JavaScript</li>
</ol>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ol>
<li>查询速度快。</li>
<li>高并发。可以达到2万个并发</li>
<li>高容量。支持10TB以上的数据量</li>
</ol>
<h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><ol>
<li>网站数据</li>
<li>缓存</li>
<li>大尺寸、低价值的数据</li>
<li>高伸缩性的场景</li>
<li>用于对象及JSON数据的存储</li>
</ol>
<h3 id="使用限制"><a href="#使用限制" class="headerlink" title="使用限制"></a>使用限制</h3><ol>
<li>在32位系统上，不支持大于2.5G的数据</li>
<li>单个文件大小限制为16M</li>
<li>高度事务性的系统：例如银行或会计系统。传统的关系型数据库目前还是更适用于需要大量原子性复杂事务的应用程序。</li>
<li>传统的商业智能应用：针对特定问题的BI数据库会对产生高度优化的查询方式。对于此类应用，数据仓库可能是更合适的选择。   </li>
</ol>
<h3 id="MongoDB与关系型数据库对比"><a href="#MongoDB与关系型数据库对比" class="headerlink" title="MongoDB与关系型数据库对比"></a>MongoDB与关系型数据库对比</h3><table>
<thead>
<tr>
<th style="text-align:center">对比项</th>
<th style="text-align:center">MongoDB</th>
<th style="text-align:center">MySQL、Oracle</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">数据库</td>
<td style="text-align:center">数据库(dataBase)</td>
<td style="text-align:center">数据库(dataBase、schema)</td>
</tr>
<tr>
<td style="text-align:center">表</td>
<td style="text-align:center">集合(collection)</td>
<td style="text-align:center">二维表(table)</td>
</tr>
<tr>
<td style="text-align:center">表中的一行数据</td>
<td style="text-align:center">文档(document)</td>
<td style="text-align:center">一条记录(record)</td>
</tr>
<tr>
<td style="text-align:center">表字段</td>
<td style="text-align:center">键(key)</td>
<td style="text-align:center">列(column)</td>
</tr>
<tr>
<td style="text-align:center">主外键</td>
<td style="text-align:center">无</td>
<td style="text-align:center">PK、FK</td>
</tr>
<tr>
<td style="text-align:center">灵活度扩展性</td>
<td style="text-align:center">极高</td>
<td style="text-align:center">差</td>
</tr>
</tbody>
</table>
<h2 id="MongoDB的安装"><a href="#MongoDB的安装" class="headerlink" title="MongoDB的安装"></a>MongoDB的安装</h2><ol>
<li><p>从官方获得MongoDB的压缩包</p>
</li>
<li><p>将其解压到 d:\，再重命名为mongo，路径为d:\mongo</p>
</li>
<li><p>创建MongoDB的数据文件夹</p>
</li>
</ol>
<h3 id="启动MongoDB服务端"><a href="#启动MongoDB服务端" class="headerlink" title="启动MongoDB服务端:"></a>启动MongoDB服务端:</h3><p>d:\mongo\bin\mongod –dbpath=d:\db –logpath=c:\mongo\logs       \mongodb.log –port=27017</p>
<h3 id="MongoDB命令参数说明"><a href="#MongoDB命令参数说明" class="headerlink" title="MongoDB命令参数说明"></a>MongoDB命令参数说明</h3><table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">dbpath</td>
<td style="text-align:center">数据文件存放路径，每个数据库会在其中创建一个子目录，用于防止同一个实例多次运行的mongod.lock  也保存在此目录中</td>
</tr>
<tr>
<td style="text-align:center">logpath</td>
<td style="text-align:center">日志文件</td>
</tr>
<tr>
<td style="text-align:center">logappend</td>
<td style="text-align:center">日志采用追加模式（默认是覆写模式）</td>
</tr>
<tr>
<td style="text-align:center">bind_ip</td>
<td style="text-align:center">对外服务的绑定ip，一般设置为空，及绑定在本机所有可用ip 上</td>
</tr>
<tr>
<td style="text-align:center">port</td>
<td style="text-align:center">对外服务端口。Web  管理端口在这个port  的基础上+1000</td>
</tr>
<tr>
<td style="text-align:center">fork</td>
<td style="text-align:center">以后台Daemon  形式运行服务</td>
</tr>
<tr>
<td style="text-align:center">journal</td>
<td style="text-align:center">开启日志功能，通过保存操作日志来降低单机故障的恢复时间</td>
</tr>
</tbody>
</table>
<h3 id="MongoDB命令参数说明-1"><a href="#MongoDB命令参数说明-1" class="headerlink" title="MongoDB命令参数说明"></a>MongoDB命令参数说明</h3><table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">syncdelay</td>
<td style="text-align:center">系统同步刷新磁盘的时间，单位为秒，默认是60 秒</td>
</tr>
<tr>
<td style="text-align:center">directoryperdb</td>
<td style="text-align:center">每个db 存放在单独的目录中，建议设置该参数</td>
</tr>
<tr>
<td style="text-align:center">maxConns</td>
<td style="text-align:center">最大连接数</td>
</tr>
<tr>
<td style="text-align:center">repairpath</td>
<td style="text-align:center">执行repair  时的临时目录。在如果没有开启journal，异常down  机后重启，必须执行repair操作</td>
</tr>
</tbody>
</table>
<h3 id="MongoDB数据库基本命令"><a href="#MongoDB数据库基本命令" class="headerlink" title="MongoDB数据库基本命令:"></a>MongoDB数据库基本命令:</h3><ol>
<li>Help查看命令提示</li>
</ol>
<p><code>db.help()</code></p>
<ol>
<li>显示当前数据库的名字</li>
</ol>
<p><code>db</code></p>
<ol>
<li>切换/创建数据库</li>
</ol>
<p><code>use 数据库名</code><br>当创建一个集合的时候会自动创建当前数据库</p>
<ol>
<li>显示所有的数据库</li>
</ol>
<p><code>show dbs</code></p>
<ol>
<li>删除当前数据库</li>
</ol>
<p><code>db.dropDatabase()</code></p>
<ol>
<li>显示当前db状态</li>
</ol>
<p><code>db.stats()</code></p>
<ol>
<li>当前db版本</li>
</ol>
<p><code>db.version()</code></p>
<ol>
<li>查看当前db的链接机器地址</li>
</ol>
<p><code>db.getMongo()</code></p>
<h3 id="MongoDB操作集合（Collection-相关操作"><a href="#MongoDB操作集合（Collection-相关操作" class="headerlink" title="MongoDB操作集合（Collection)相关操作"></a>MongoDB操作集合（Collection)相关操作</h3><ol>
<li>创建集合</li>
</ol>
<p>显示创建:<code>db.createCollection(“users”);</code></p>
<p>隐式创建:<code>db.users.insert({name:”suns”,age:10})</code></p>
<ol>
<li>显示当前数据库中的所有集合</li>
</ol>
<p><code>show collections</code><br><code>show tables</code></p>
<ol>
<li>删除集合</li>
</ol>
<p><code>db.users.drop()</code></p>
<h3 id="MongoDB操作文档-Document-相关操作"><a href="#MongoDB操作文档-Document-相关操作" class="headerlink" title="MongoDB操作文档(Document)相关操作"></a>MongoDB操作文档(Document)相关操作</h3><ol>
<li>创建文档</li>
</ol>
<p><code>db.users.insert({name:”suns”,age:10})</code><br>自动生成一个全球唯一的主键：时间戳、机器、PID、计数器</p>
<ol>
<li>删除文档</li>
</ol>
<p><code>db.users.remove({})</code></p>
<p><code>db.users.remove({name:”suns”})</code></p>
<ol>
<li>修改文档</li>
</ol>
<p><code>db.users.update(query,update,upsert, multi)</code></p>
<p><code>query</code><br>修改的条件</p>
<p><code>update</code><br>更新的命令</p>
<p><code>upsert</code><br>如果未发现符合要求的数据内容，是否进行插入操作，1或者true 进行插入，0或者false不进行插入</p>
<p><code>multi</code>   是否进行多行更新，1或者true 进行多行更新，0或者false不进行多行更新</p>
<p>4.修改文档具体案例</p>
<p><code>db.users.update({name:”suns”},{$set:{password:”888”}},0, 1)</code> </p>
<p><code>$set</code></p>
<p>等同于sql语句中的set</p>
<p><code>$inc</code></p>
<p>为对应key中的数据内容进行算数运算</p>
<p><code>db.users.update({},{$inc:{age:1},0,1})</code></p>
<h3 id="MongoDB查询相关操作"><a href="#MongoDB查询相关操作" class="headerlink" title="MongoDB查询相关操作"></a>MongoDB查询相关操作</h3><ol>
<li>基本查询操作</li>
</ol>
<p>查询集合中所有内容:<code>db.users.find();</code><br>查询集合中第一个内容:`b.users.findOne();</p>
<ol>
<li>条件查询</li>
</ol>
<ul>
<li><code>=</code>条件 </li>
</ul>
<p><code>db.users.find({name:”suns”})</code> </p>
<ul>
<li><code>!=</code>条件 </li>
</ul>
<p><code>ne db.users.find({name:{“$ne”:”suns”}})</code> </p>
<ul>
<li><code>&gt;</code>条件 </li>
</ul>
<p><code>gt db.users.find({age:{“$gt”:10}})</code></p>
<ul>
<li><code>&lt;</code>条件 </li>
</ul>
<p><code>lt db.users.find({age:{“$lt”:10}})</code></p>
<ul>
<li><code>&gt;=</code>条件 </li>
</ul>
<p><code>gte db.users.find({age:{“$gte”:10}})</code></p>
<ul>
<li><code>&lt;=</code> 条件 </li>
</ul>
<p><code>lte db.users.find({age:{“$lte”:10}})</code></p>
<ol>
<li>逻辑运算</li>
</ol>
<ul>
<li><code>与运算</code> </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;name:”suns”,age:10&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>或运算</code> </li>
</ul>
<p><code>$or</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;$or:[&#123;name:”suns1”&#125;,&#123;age:32&#125;]&#125;)</span><br></pre></td></tr></table></figure></p>
<p><code>$nor</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;$nor:[&#123;name:”suns1”&#125;,&#123;age:32&#125;]&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>集合运算</li>
</ol>
<ul>
<li><code>$in</code> </li>
</ul>
<p>类似于关系型数据库中的in操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;age:&#123;$in:[23,24,25]&#125;&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>$all</code> </li>
</ul>
<p>主要用来查询数组中的包含关系，查询条件中只要有一个不包含就不返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;suns1&quot;,&quot;post&quot;:[1,2,3]&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;suns1&quot;,&quot;post&quot;:[2,3,4]&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;suns1&quot;,&quot;post&quot;:[2,5,7]&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;suns1&quot;,&quot;post&quot;:[3,9,10]&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;post:&#123;$all:[2,3]&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>一行二行出现23</p>
<ol>
<li>统计、排序、分页</li>
</ol>
<ul>
<li>统计</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.users.count();</span><br><span class="line">db.users.find().count();</span><br><span class="line">db.users.find(&#123;age:&#123;$lt:5&#125;&#125;).count();</span><br></pre></td></tr></table></figure>
<ul>
<li>排序</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.users.find().sort(&#123;age:1&#125;); //升序</span><br><span class="line">db.users.find().sort(&#123;age:-1&#125;); //降序</span><br></pre></td></tr></table></figure>
<ul>
<li>分页</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.users.find().skip(2).limit(3);</span><br><span class="line">db.users.find().sort(&#123;age:-1&#125;).skip(2).limit(3);</span><br><span class="line">db.users.find().sort(&#123;age:-1&#125;).skip(2).limit(3).count(0); //忽略分页效果</span><br><span class="line">db.users.find().sort(&#123;age:-1&#125;).skip(2).limit(3).count(1); //记录分页效果</span><br></pre></td></tr></table></figure>
<ol>
<li>特殊查询</li>
</ol>
<ul>
<li>投影查询</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure>
<p><code>$exists</code> 判断一个key是否存在 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;name:&#123;$exists:1&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="MongoDB的索引"><a href="#MongoDB的索引" class="headerlink" title="MongoDB的索引"></a>MongoDB的索引</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p>索引就是用来加速查询的。数据库索引与书籍的索引类似：有了索引就不需要翻遍整本书，数据库则可以直接在索引中查找，使得查找速度能提高几个数量级。在索引中找到条目以后，就可以直接跳转到目标文档的位置。</p>
<h3 id="普通索引相关命令"><a href="#普通索引相关命令" class="headerlink" title="普通索引相关命令"></a>普通索引相关命令</h3><ul>
<li><p>创建普通</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.ensureIndex(&#123;key:1&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看关于索引的相关信息</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.stats()</span><br></pre></td></tr></table></figure>
<ul>
<li>查看查询使用索引的情况</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&#123;key:value&#125;).explain()</span><br></pre></td></tr></table></figure>
<ul>
<li>删除索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.dropIndex(&#123;key:1&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>删除集合，也会将集合中的索引全部删除</li>
</ul>
<h3 id="唯一索引相关命令"><a href="#唯一索引相关命令" class="headerlink" title="唯一索引相关命令"></a>唯一索引相关命令</h3><ul>
<li>创建唯一索引 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 查看关于索引的相关信息</span><br><span class="line"></span><br><span class="line">```db.collection.stats()</span><br></pre></td></tr></table></figure>
<ul>
<li>查看查询使用索引的情况</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 删除索引</span><br><span class="line"></span><br><span class="line">```db.collection.dropIndex(&#123;key:1&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>删除集合，也会将集合中的索引全部删除</li>
</ul>
<h2 id="MongoDB的复制"><a href="#MongoDB的复制" class="headerlink" title="MongoDB的复制"></a>MongoDB的复制</h2><p>2018年4月23日23:18:16 25/48</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">HibisciDai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://hibiscidai.com/2018/04/21/2018-4-21-Mongodb学习笔记/">http://hibiscidai.com/2018/04/21/2018-4-21-Mongodb学习笔记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hibiscidai.com" target="_blank">HibisciDai</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Mongodb/">Mongodb</a><a class="post-meta__tags" href="/tags/集群/">集群</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/zhifubaodashang.jpg"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/weixin.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share" data-disabled="linkedin,diandian"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script><nav id="pagination"><div class="next-post pull-right"><a href="/2018/04/02/text-picture/"><span>text-picture</span><i class="fa fa-chevron-right"></i></a></div></nav><div class="post-adv"><a href="https://www.vultr.com/?ref=7361664"><img src="https://www.vultr.com/media/banner_1.png" width="728" height="90"></a></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTQ2NC8xMjAwMA=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2018 By HibisciDai</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.1"></script><script src="/js/fancybox.js?version=1.5.1"></script><script src="/js/sidebar.js?version=1.5.1"></script><script src="/js/copy.js?version=1.5.1"></script><script src="/js/fireworks.js?version=1.5.1"></script><script src="/js/transition.js?version=1.5.1"></script><script src="/js/scroll.js?version=1.5.1"></script><script src="/js/head.js?version=1.5.1"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>